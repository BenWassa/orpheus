<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Project Orpheus — Dataset library</title>
    <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
    <header class="site-header">
        <div class="site-header__inner">
            <a class="site-brand" href="index.html">
                <span class="site-brand__icon" aria-hidden="true">♪</span>
                <span>Project Orpheus</span>
            </a>
            <nav class="site-nav">
                <a href="index.html" aria-current="page">Datasets</a>
                <a href="README.html">Static guide</a>
            </nav>
        </div>
    </header>
    <main class="page">
        <section class="hero">
            <span class="hero__note">Static snapshot</span>
            <h1 class="main-header">Explore your exported playlists</h1>
            <p class="subtitle">Browse {{ dataset_count }} curated {{ dataset_label }} generated with the Project Orpheus pipeline.</p>
            <div class="hero__actions">
                <a class="primary" href="README.html">Learn how the export works</a>
                <a class="secondary" href="README.html#regenerating-the-site">Regenerate this site</a>
            </div>
            <p class="subtitle" style="margin-top:1.5rem; font-size:0.95rem; color: var(--color-subtle, #6b7280);">Last generated {{ generated_at }}</p>
        </section>

        <section class="card search-card" aria-labelledby="dataset-search-label">
            <div class="search-field">
                <svg aria-hidden="true" focusable="false" viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 1 0-.71.71l.27.28v.79l5 5L20.49 19zm-6 0A4.5 4.5 0 1 1 14 9.5 4.5 4.5 0 0 1 9.5 14"/></svg>
                <label class="sr-only" id="dataset-search-label" for="dataset-search">Search datasets</label>
                <input id="dataset-search" type="search" placeholder="Search by dataset name" autocomplete="off" />
            </div>
            <p style="margin:0; color: var(--color-subtle, #6b7280); font-size:0.95rem;">Filter by dataset title. Results update instantly.</p>
        </section>

        <section class="dataset-grid" id="dataset-grid" aria-live="polite"></section>
        <div class="empty-state" id="dataset-empty" hidden>
            <h2>No datasets found</h2>
            <p>Try another search term or regenerate the site with new CSV files.</p>
        </div>
    </main>
    <footer class="site-footer">
        <p>This static export is read-only. Launch the interactive Streamlit app to upload new playlists or tweak filters.</p>
    </footer>

    <script>
        const DATASETS = {{ dataset_json }};
        const grid = document.getElementById('dataset-grid');
        const searchInput = document.getElementById('dataset-search');
        const emptyState = document.getElementById('dataset-empty');

        const formatRange = (range) => {
            if (!range) return '—';
            const start = range.start || '—';
            const end = range.end || '—';
            return `${start} → ${end}`;
        };

        const formatTimestamp = (value) => {
            if (!value) return '';
            const date = new Date(value);
            if (Number.isNaN(date.valueOf())) {
                return value;
            }
            return date.toLocaleString(undefined, {
                year: 'numeric',
                month: 'short',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                timeZoneName: 'short'
            });
        };

        const createCard = (dataset) => {
            const article = document.createElement('article');
            article.className = 'dataset-card';
            const thumbSrc = dataset.thumbnail || 'assets/images/dataset-default.svg';
            const updated = formatTimestamp(dataset.generatedAt);
            article.innerHTML = `
                <a href="${dataset.href}" class="dataset-card__thumbnail" aria-label="Open ${dataset.name}">
                    <img src="${thumbSrc}" alt="" loading="lazy" />
                </a>
                <div class="dataset-card__body">
                    <h2 class="dataset-card__title"><a href="${dataset.href}">${dataset.name}</a></h2>
                    <div class="dataset-card__meta">
                        <div><span>Tracks</span><strong>${dataset.trackCount}</strong></div>
                        <div><span>Unique artists</span><strong>${dataset.uniqueArtists}</strong></div>
                        <div style="grid-column: 1 / -1;"><span>Date range</span><strong>${formatRange(dataset.dateRange)}</strong></div>
                    </div>
                    <div class="dataset-card__footer">
                        <div class="dataset-card__links">
                            <a href="${dataset.href}">View analysis</a>
                            <a class="summary-link" href="${dataset.summaryHref}">summary JSON</a>
                        </div>
                        ${updated ? `<span style="font-size:0.85rem; color: var(--color-subtle, #6b7280);">Updated ${updated}</span>` : ''}
                    </div>
                </div>
            `;
            return article;
        };

        const render = (datasets) => {
            grid.innerHTML = '';
            if (!datasets.length) {
                emptyState.hidden = false;
                return;
            }
            emptyState.hidden = true;
            datasets.forEach((dataset) => {
                grid.appendChild(createCard(dataset));
            });
        };

        const normalise = (value) => value.toLowerCase();

        searchInput.addEventListener('input', (event) => {
            const query = normalise(event.target.value.trim());
            if (!query) {
                render(DATASETS);
                return;
            }
            const filtered = DATASETS.filter((dataset) => normalise(dataset.name).includes(query));
            render(filtered);
        });

        render(DATASETS);
    </script>
</body>
</html>
